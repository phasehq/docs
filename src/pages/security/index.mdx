import { Tag } from '@/components/Tag'
import { HeroPattern } from '@/components/HeroPattern'

export const description =
  'An overview of the Phase architecture, threat model and high level concepts.'

<HeroPattern />

<Tag variant="small">SECURITY</Tag>

# Security Overview

Phase is designed to give developers strong, versatile, reliable application secrets and configuration management platform that is laser focused on security, developer experience and integrations. Giving developers access to strong security tools that can be easily adopted and implement in early stages of development help shift security left.

## TL;DR

What is end-to-end encrypted?

-

When is something not end-to-end encrypted?

What is encrypted only at transport via TLS?

How is it encrypted?

## Security Objectives

To provide developers with strong security via end-to-end encrypted configuration and secrets management system that is secure, cryptographically sound, reliable, easy to use, and easy to integrate.

No host server or third party should be trusted by any EnvKey client. Even if an EnvKey host server is compromised, it shouldn't be possible for the attacker to read or modify an organization's secrets (except for deleting them).

Even if an attacker compromises the email or SSO account a user uses to authenticate with EnvKey, it shouldn't be possible for the attacker to read or modify an organization's secrets.

Implement reliable, standards-based cryptography with proven libraries.

Protect against real world threats and avoid known theoretical vulnerabilities. Beyond that, don't increase key sizes, add optimizations, or complicate user experience beyond what's needed to achieve this goal.

## Out of scope

User devices and connected servers are assumed to be trusted. EnvKey does not attempt to protect against endpoint compromise, either through physical access, or through viruses, keyloggers, Operating System exploits, privilege escalation, or other attacks.

EnvKey does make it easy to cut off access as soon as possible, to track which secrets may have been exposed, and to contain the fallout by rotating them quickly.

EnvKey also integrates with the OS keyring on Mac and Windows, only stores encrypted data on disk, and evicts secrets from RAM if they haven't been accessed recently, all of which could help to mitigate the fallout of an endpoint attack.

---

## Third party services (Phase Cloud)

### Hosting - Cloudflare

- Reverse proxy
- Cache
- Workers
- Pages
- WAF
- DDoS Protection
- Rate limiting

### Hosting - AWS

- EC2 - Compute
- RDS Postgresql - Relational database
- ElastiCache Redis - In memory database
- SES - Transactional Emails

### Analytics

- PostHog
- Cloudflare Web Analytics

## Account

Your Phase account is more than just a way to login and access the Phase Console. It is associated with cryptographic keys which help secure your Apps, and ensure that sensitive privileged operations can only be performed by you.

### Keyring

When you sign up for the Phase Console, your Account will be setup with a set of cryptographic keys, called an Account Keyring.
Part of the signup process will involve recording and safely storing a 24-word recovery phrase that is used to recover these keys.

The recovery phrase is used to deterministically derive the following cryptographic keys which comprise your Account Keyring:

- **[Symmetric Key](/security/phase-encryption#phase-console-client-side-key-generation)** - used to secure your App keys.
- **[Signing Key Pair](/security/phase-encryption#phase-console-client-side-key-generation)** - used to validate your recovery key when recovering your account or logging in on a new device.

Once your Account is setup, you will have sole access to the recovery phrase. It is extremely important that you store your recovery phrase in a safe place, as it is the root source of entropy from which your Account Keyring can be retrieved.

Depending on your threat model, we recommend you:

- Write down or print the 24-word recovery phrase and store it some place safe
- Save it in a password manager or vault

### The `sudo` password

Part of the signup / login process also involves setting up a `sudo` password. This password is used to encrypt your Account keys and store them locally in your browser. To perform certain operations such as creating an App, or rotating an `APP_SECRET`, you will be asked to enter this `sudo` password so that your Account Keyring can be decrypted in memory.

If you want to login to the Phase console on a new device or browser, you will need to re-enter your recovery key and set up a new `sudo` password.

<div className="not-prose">
  <Button
    href="/security/phase-encryption#phase-console-client-side-key-generation"
    variant="text"
    arrow="right"
    children="More info"
  />
</div>

---

## Tokens

User token

Service token

```bash
pss_user_pattern = re.compile(r"^pss_user:v(\d+):([a-fA-F0-9]{64}):([a-fA-F0-9]{64}):([a-fA-F0-9]{64}):([a-fA-F0-9]{64})$")
pss_service_pattern = re.compile(r"^pss_service:v(\d+):([a-fA-F0-9]{64}):([a-fA-F0-9]{64}):([a-fA-F0-9]{64}):([a-fA-F0-9]{64})$")
```

To use Phase encryption with your application, you will need to create an App on Phase. Each Phase App is associated with the following cryptographic keys:

- **[App Public Key](https://en.wikipedia.org/wiki/YubiKey)** - used to encrypt application data
- **[App Private Key](https://en.wikipedia.org/wiki/YubiKey)** - used to decrypt application data

These two keys are used to create your `APP_ID` and `APP_SECRET` respectively. App keys are used by the Phase [SDKs](/sdks) to encrypt and decrypt data in your applications.

The `APP_ID` is public and not considered a secret. You can add this value as an environment variable in front-end applications safely.

The `APP_SECRET`, as the name suggests, is secret and should never be placed in front-end code. Anyone with access to this value will be able to decrypt data in your application.

<div className="not-prose">
  <Button
    href="/security/phase-encryption#app-keys-and-secret-generation"
    variant="text"
    arrow="right"
    children="More info"
  />
</div>

---

## Secret sharding

The App private key is used to decrypt data, however storing this private key in plaintext in a single location poses several security risks. A breach of this value is impossible to recover from, since the private key itself cannot be changed for given App.

To solve this problem, Phase uses a Dual-Key model. Your App private key is split into 2 shares. One of these shares is contained within the `APP_SECRET`, while the other is stored on the Phase KMS (Key Management Service). Each share on its own cannot be used to recreate your private key.

During a decrypt operation, the Phase SDKs put these two shares together to reconstruct your App private key in memory, which is then used to decrypt application data.

This means that your App private key is never stored in a single place where it could be accidentally committed to version control, stolen by an attacker or otherwise compromised.

<div className="not-prose">
  <Button
    href="/security/phase-encryption#app-keys-and-secret-generation"
    variant="text"
    arrow="right"
    children="More info"
  />
</div>
