import { Tag } from '@/components/Tag'

export const description =
  'Mange your secrets and environment variables with the Phase CLI'

<Tag variant="small">CLI</Tag>

# Usage

The Phase CLI works together with the [Phase Console](https://github.com/phasehq/console) to securely sync your secrets and environment variables with **End-to-End Encryption**. It is designed to pull secrets, decrypt them and inject secrets directly into your application or framework during runtime. You can use it to create, retrieve, update and delete your application secrets for different environments such as `development`, `staging`, `production` or something custom.

## Get started {{ className: 'lead' }}

### Login

Create an app in the [Phase Console](https://console.phase.dev) and copy appID and pss

```bash
phase auth
```

### Initialize

Link the phase cli to your project

```bash
phase init
```

This will create a `.phase.json` file in the root of your project

## Import your existing secrets

Let's say you already have a `.env` file containing your secrets and environment variables for your app.

Example:

```py
DEBUG=True
ALLOWED_HOST = localhost
AWS_ACCESS_KEY_ID = AKIA2OGYBAH6QLWOYDVN
AWS_SECRET_ACCESS_KEY = 6ACbdYki5FISnaiWYZwwyQcAEcnKmNrULTCXw+RQ
REGION = us-east-2
```

You can simply import it via:

```bash
phase secrets import .env
```

## List / view secrets

```bash
phase secrets list --show
```

Example:

```bash
phase secrets list --show
KEY üóùÔ∏è                    | VALUE ‚ú®
--------------------------------------------------------------------------------------
ALLOWED_HOST             | localhost
DEBUG                    | True
AWS_ACCESS_KEY_ID        | AKIA2OGYBAH6QLWOYDVN
AWS_SECRET_ACCESS_KEY    | 6ACbdYki5FISnaiWYZwwyQcAEcnKmNrULTCXw+RQ
REGION                   | us-east-2
```

## Run and inject secrets

```bash
phase run <your_run_command>
```

Example 1:

```bash
# Node.js project manged by yarn package manager
phase run yarn dev

$ next dev
ready - started server on 0.0.0.0:3000, url: http://localhost:3000
```

Example 2:

```bash
# Chaining multiple commands together with linux pipes
phase run "printenv | grep AWS_ACCESS_KEY_ID"

AWS_ACCESS_KEY_ID=AKIA2OGYBAH6QLWOYDVN
```

## Export secrets back to .env file

```
phase secrets export
```

This will create an `.env` file and export all secrets as key value pairs in the given environment

## Switching between environments via the `--env` flag

Phase Console by default creates three environment for each application. ie. `development`, `staging` and `production`. You can switch in between them via the `--env` followed by the environment name or prefix. Keep in mind, **by default the Phase CLI will use the `development` environment** even if the `--env` flag is not passed.

Example 1:

```bash
phase secrets create HOST --env staging
```

Example 2:
It's also possible to provide an environment prefix for brevity

```bash
phase secrets list --env stag # Even though environment name is staging
```

Example 3:

```bash
phase run --env prod "python manage.py migrate && python manage.py runserver backend:8000"
```

## Secret referencing

Phase Console and CLI also support dotenv styled secret referencing.

You can refer a value of a secret residing in your current environment (eg. development) or across environments. Values prefixed with a `üîó` indicate local secrets value being referenced and values prefixed with `‚õìÔ∏è` indicate cross environment secret value being referenced.

The syntax is as follows:

Local: `${<key>}`

Cross environment: `${<environment>.<key>}`

**Examples**:

Local environment secret referencing:

```bash
phase secrets list --env prod --show
KEY üóùÔ∏è                   | VALUE ‚ú®
-------------------------------------------------------------------------------------------------
DJANGO_SECRET_KEY        | 7842cc89c5a703acdf4797e0f063e1851734cea0677ad9382158cfcee26195df
DJANGO_DEBUG             | True
DB_NAME                  | XP1_LM
DB_USER                  | j_mclaren
DB_PASSWORD              | 6c37810ec6e74ec3228416d2844564fceb99ebd94b29f4334c244db011630b0e
DB_HOST                  | mc-laren-prod-db.c9ufzjtplsaq.us-west-1.rds.amazonaws.com
DB_PORT                  | 5432
DATABASE_URL             | üîó postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}
```

The database connection string `postgresql://` is referencing `DB_USER`, `DB_PASSWORD`, `DB_HOST`, `DB_PORT` and `DB_NAME` from the same environment (dev/development)

Cross environment secret referencing:

```bash
phase secrets list --env prod --show
KEY üóùÔ∏è                   | VALUE ‚ú®
-------------------------------------------------------------------------------------------------
AWS_ACCESS_KEY_ID        | ‚õìÔ∏è ${dev.AWS_ACCESS_KEY_ID}
AWS_SECRET_ACCESS_KEY    | ‚õìÔ∏è ${dev.AWS_SECRET_ACCESS_KEY}
```

Note: This is assuming an environment (dev/development) has a secret with the key `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`.
